{"remainingRequest":"C:\\Projects\\Согласование\\CR_Approve_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Projects\\Согласование\\CR_Approve_vue\\src\\views\\Auth\\Auth.vue?vue&type=style&index=0&lang=less&module=true&","dependencies":[{"path":"C:\\Projects\\Согласование\\CR_Approve_vue\\src\\views\\Auth\\Auth.vue","mtime":1620229007546},{"path":"C:\\Projects\\Согласование\\CR_Approve_vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Projects\\Согласование\\CR_Approve_vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Projects\\Согласование\\CR_Approve_vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Projects\\Согласование\\CR_Approve_vue\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Projects\\Согласование\\CR_Approve_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Projects\\Согласование\\CR_Approve_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCkBpbXBvcnQgIi4vc3R5bGUvbW9iaWxlLmxlc3MiOw0KDQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIHsNCiAgICBAaW1wb3J0ICIuL3N0eWxlL3RhYmxldC5sZXNzIjsNCn0NCg0KQG1lZGlhIChtaW4td2lkdGg6IDEzNjZweCkgew0KICAgIEBpbXBvcnQgIi4vc3R5bGUvZGVza3RvcC5sZXNzIjsNCn0NCg=="},{"version":3,"sources":["Auth.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyPA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"Auth.vue","sourceRoot":"src/views/Auth","sourcesContent":["<template lang=\"pug\">\r\n    div(:class=\"[{ [$style.await]: wait }, $style.login,]\")\r\n        div(:class=\"$style.wrapper\")\r\n            div(:class=\"$style.left\")\r\n                div(:class=\"$style.titleText\") Добро пожаловать!\r\n                h1(:class=\"$style.title\") Система мониторинга процесса разработки клинических рекомендаций\r\n                div(v-if=\"authError\", :class=\"[$style.text, $style.errorText]\") {{ authError.message }}\r\n                div(v-else, :class=\"$style.text\")\r\n                    span(v-if=\"show==1\") Для продолжения работы необходимо пройти авторизацию\r\n                    span(v-if=\"show==2\") Для восстановления пароля необходимо ввести e-mail адрес\r\n                    span(v-if=\"show==3\") Введите код подтверждения, отправленный Вам на email\r\n                    span(v-if=\"show==4\") Придумайте новый пароль\r\n                form(:class=\"$style.form\" autocomplete=\"off\" id=\"form\" action=\"javascript:void(0);\")\r\n                    div(v-if=\"show==1\" :class=\"[$style.group, $style.first]\")\r\n                        div(:class=\"$style.input\")\r\n                            input(\r\n                                :class=\"[{ [$style.error]: authError }, $style.inputField]\"\r\n                                placeholder=\"E-mail\"\r\n                                name=\"email\"\r\n                                v-model=\"form.login\"\r\n                            )\r\n                            div(v-if=\"form.login\", :class=\"$style.linkBLock\")\r\n                                a(:class=\"$style.clean\", href, title, @click.prevent=\"form.login=''\", tabindex=\"-1\")\r\n                                    Close\r\n                    div(v-if=\"show==2\" :class=\"[$style.group, $style.first]\")\r\n                        div(:class=\"$style.input\")\r\n                            input(\r\n                                :class=\"[{ [$style.error]: authError }, $style.inputField]\"\r\n                                type=\"email\"\r\n                                placeholder=\"E-mail\"\r\n                                name=\"email\"\r\n                                v-model=\"email\"\r\n                                requared\r\n                                id=\"mail\"\r\n                            )\r\n                            div(v-if=\"form.login\", :class=\"$style.linkBLock\")\r\n                                a(:class=\"$style.clean\", href, title, @click.prevent=\"email=''\", tabindex=\"-1\")\r\n                                    Close\r\n                    div(v-if=\"show==3\" :class=\"[$style.group, $style.first]\")\r\n                        div(:class=\"$style.input\")\r\n                            input(\r\n                                :class=\"[{ [$style.error]: authError }, $style.inputField]\"\r\n                                placeholder=\"Код подтверждения\"\r\n                                name=\"token\"\r\n                                v-model=\"token\"\r\n                            )\r\n                            div(v-if=\"form.login\", :class=\"$style.linkBLock\")\r\n                                a(:class=\"$style.clean\", href, title, @click.prevent=\"token=''\", tabindex=\"-1\")\r\n                                    Close\r\n                    div(v-if=\"show==4\" :class=\"[$style.group, $style.first]\")\r\n                        div(:class=\"$style.input\")\r\n                            input(\r\n                                :class=\"[{ [$style.error]: authError }, $style.inputField]\"\r\n                                placeholder=\"Введите пароль\"\r\n                                name=\"pass\"\r\n                                v-model=\"pass\"\r\n                            )\r\n                            div(v-if=\"form.login\", :class=\"$style.linkBLock\")\r\n                                a(:class=\"$style.clean\", href, title, @click.prevent=\"pass=''\", tabindex=\"-1\")\r\n                                    Close\r\n                    div(v-if=\"show==4\" :class=\"[$style.group, $style.first]\")\r\n                        div(:class=\"$style.input\")\r\n                            input(\r\n                                :class=\"[{ [$style.error]: authError }, $style.inputField]\"\r\n                                placeholder=\"Подтвердите пароль\"\r\n                                name=\"pass2\"\r\n                                v-model=\"pass2\"\r\n                            )\r\n                            div(v-if=\"form.login\", :class=\"$style.linkBLock\")\r\n                                a(:class=\"$style.clean\", href, title, @click.prevent=\"pass2=''\", tabindex=\"-1\")\r\n                                    Close\r\n                    div(v-if=\"show==1\" :class=\"[$style.group, $style.last]\")\r\n                        div(:class=\"$style.input\")\r\n                            input(\r\n                                :class=\"[{ [$style.error]: authError }, $style.inputField]\"\r\n                                :type=\"passwordType\"\r\n                                placeholder=\"Пароль\"\r\n                                name=\"password\"\r\n                                v-model=\"form.password\"\r\n                            )\r\n                            div(v-if=\"form.password\", :class=\"$style.linkBLock\")\r\n                                a(\r\n                                    :class=\"$style.eye\"\r\n                                    href\r\n                                    title\r\n                                    @click.prevent=\"\"\r\n                                    @mousedown=\"passwordType = 'text'\"\r\n                                    @mouseup=\"passwordType = 'password'\"\r\n                                    @mouseleave=\"passwordType = 'password'\"\r\n                                )\r\n                                    Eye(v-if=\"passwordType === 'text'\", :class=\"$style.eyeHidden\")\r\n                                    EyeSlash(v-else, :class=\"$style.eyeHidden\")\r\n                                a(:class=\"$style.clean\", href, title, @click.prevent=\"form.password = ''\")\r\n                                    Close\r\n                    div(:class=\"[$style.group, $style.check]\")\r\n                        div(v-if=\"show==1\" :class=\"$style.checkbox\")\r\n                            input(\r\n                                type=\"checkbox\"\r\n                                name=\"remember\"\r\n                                id=\"remember\"\r\n                                value=\"Запомнить меня\"\r\n                                v-model=\"form.rememberMe\"\r\n                                :class=\"$style.checkboxInput\"\r\n                            )\r\n                            label(for=\"remember\", :class=\"$style.name\")\r\n                                span(:class=\"$style.checkboxText\") Запомнить меня\r\n                        span(\r\n                            v-if=\"show==1\"\r\n                            style=\"text-transform:none;cursor:pointer\"\r\n                            title=\"Забыли пароль?\"\r\n                            :class=\"$style.link\"\r\n                            @click=\"show=2\"\r\n                        ) Забыли пароль?\r\n                        span(\r\n                            v-if=\"show > 1\"\r\n                            style=\"text-transform:none;cursor:pointer\"\r\n                            title=\"Вернуться назад\"\r\n                            :class=\"$style.link\"\r\n                            @click=\"show=show-1\"\r\n                        ) Вернуться назад\r\n                    div(:class=\"[$style.group, $style.button]\")\r\n                        button(v-if=\"show==1\" @click=\"authorization\" :disabled=\"disabled\" :class=\"$style.buttonNext\") Войти\r\n                        button(v-if=\"show==2\" @click=\"checkEmail\" :disabled=\"email.length==0\" :class=\"$style.buttonNext\") Отправить код\r\n                        button(v-if=\"show==3\" @click=\"checkToken(token)\" :disabled=\"token.length==0\" :class=\"$style.buttonNext\") Продолжить\r\n                        button(v-if=\"show==4\" @click=\"checkPassword(pass, pass2)\" :class=\"$style.buttonNext\") Сохранить\r\n        div(:class=\"$style.imageWrapperDesktop\")\r\n            Rus\r\n        div(:class=\"$style.imageWrapperMobile\")\r\n            RusMobile\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters, mapActions } from 'vuex'\r\nimport Rus from '@/assets/images/inhtml/rus.svg?inline'\r\nimport Eye from '@/assets/icons/svg/eye.svg?inline'\r\nimport EyeSlash from '@/assets/icons/svg/eye-slash.svg?inline'\r\nimport Close from '@/assets/icons/svg/close.svg?inline'\r\nimport RusMobile from '@/assets/images/inhtml/rus-mobile.svg?inline'\r\n\r\nexport default {\r\n    components: { Rus, RusMobile, Eye, Close, EyeSlash },\r\n    data: () => ({\r\n        show: 1,\r\n        authError: null,\r\n        email: '',\r\n        pass: '',\r\n        pass2: '',\r\n        token: '',\r\n        id_user: null,\r\n        form: {\r\n            login: '',\r\n            password: '',\r\n            rememberMe: false,\r\n        },\r\n        wait: false,\r\n        passwordType: 'password',\r\n    }),\r\n\r\n    computed: {\r\n        disabled () {\r\n            const { login, password, wait } = this.form\r\n            return !(login && password && !wait)\r\n        },\r\n        ...mapGetters({\r\n            // authError: 'account/getError'\r\n        }),\r\n    },\r\n\r\n    methods: {\r\n        ...mapActions({\r\n            login: 'auth/auth',\r\n            apiAll: 'api/apiAll'\r\n        }),\r\n        authorization() {\r\n            this.wait = true\r\n            this.login(this.form).then(res => {\r\n                if(res.data.role.id !== 5) this.$router.push('/listCr')\r\n                else this.$router.push('/listUser')\r\n            })\r\n            .catch(error => {\r\n                if(error.response.status == 404)\r\n                    this.$notify({ group: 'foo', duration: 5000, type: 'error', title: 'Ошибка...', text: 'Данный пользователь не найден или заблокирован!' })\r\n            })\r\n        },\r\n        checkEmail() {\r\n            let email = document.getElementById('mail'),\r\n            emailRegExp = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n\r\n            if(email.validity.valid && emailRegExp.test(this.email)) {\r\n                this.apiAll({type: 'get', url: `api/Users/EmailValidator/${this.email}`, id: undefined})\r\n                .then(res => {\r\n                    if(res.status == 200){\r\n                        this.$notify({ group: 'foo', duration: 7000, type: 'success', title: 'Успешно...', text: 'Код отправлен!' })\r\n                        this.show = 3\r\n                        this.id_user = res.data.userId\r\n                    }\r\n                })\r\n                .catch(error => {\r\n                    if(error.status == 404){\r\n                        this.$notify({ group: 'foo', duration: 5000, type: 'error', title: 'Ошибка...', text: 'Введенный Вами e-mail не зарегистрирован в системе' })\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        checkToken(token) {\r\n            this.apiAll({type: 'post', url: `api/Users/TokenValidator?Id=${this.id_user}&Token=${token}`, obj: {Id: this.id_user, Token: token}, id: undefined})\r\n            .then(res => {\r\n                if(res.status == 200){\r\n                    this.show = 4\r\n                }\r\n            })\r\n            .catch(error => {\r\n                this.$notify({ group: 'foo', duration: 5000, type: 'error', title: 'Ошибка...', text: 'Код указан неверно!' })\r\n            })\r\n        },\r\n        checkDigits(pass) {\r\n            let digits = \"0123456789\",\r\n            cntCheckDigits = 0;\r\n            for (let i = 0; i < pass.length; i++) if(digits.indexOf(pass[i]) != -1) cntCheckDigits++\r\n            return cntCheckDigits >= 4 ? true : false\r\n        },\r\n        checkPassword(pass, pass2) {\r\n            if(pass === pass2) {\r\n                if(this.checkDigits(pass) && pass.length > 5) {\r\n                    this.apiAll({type: 'post', url: `api/Users/PasswordSetter?Id=${this.id_user}&Password=${pass}`, obj: {Id: this.id_user, Password: pass}, id: undefined})\r\n                    .then(res => {\r\n                        if(res.status == 200){\r\n                            this.id_user = null\r\n                            this.email = ''\r\n                            this.pass = ''\r\n                            this.pass2 = ''\r\n                            this.token = ''\r\n                            this.show = 1\r\n                            this.$notify({ group: 'foo', duration: 5000, type: 'success', title: 'Успех...', text: 'Пароль успешно изменен!' })\r\n                        }\r\n                    })\r\n                } else {\r\n                    this.$notify({ group: 'foo', duration: 7000, type: 'error', title: 'Ошибка...', text: 'В пароле должно быть не менее 6 знаков и 4 цифр!' })\r\n                }\r\n            } else {\r\n                this.$notify({ group: 'foo', duration: 5000, type: 'error', title: 'Ошибка...', text: 'Пароли не совпадают!' })\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n</script>\r\n\r\n<style lang='less' module>\r\n@import \"./style/mobile.less\";\r\n\r\n@media (min-width: 768px) {\r\n    @import \"./style/tablet.less\";\r\n}\r\n\r\n@media (min-width: 1366px) {\r\n    @import \"./style/desktop.less\";\r\n}\r\n</style>"]}]}